pkgname=wslbridge
pkgver=0.1.0
pkgrel=1
arch=('i686' 'x86_64')
license=('MIT')
url="https://github.com/rprichard/wslbridge"
source=("https://github.com/rprichard/wslbridge/archive/0.1.0.tar.gz")
sha256sums=('SKIP')

bow_run() {
  /usr/bin/winpty.exe /c/Windows/System32/bash.exe -c "$*"
}

build() {
  cd $srcdir/$pkgname-$pkgver

  # build frontend at MSYS2
  cd frontend/
  make

  # build backend at BoW
  srcdir_wsl='/mnt/'$(cygpath -m $srcdir | sed -e 's!^\([A-Z]\):!\L\1!')
  bow_run "sudo apt-get install -y make g++"
  bow_run "cd $srcdir_wsl/$pkgname-$pkgver/backend && make"
}

package() {
  cd $srcdir/$pkgname-$pkgver

  mkdir -p $pkgdir/usr/bin
  cp -r out/wslbridge.exe $pkgdir/usr/bin/
  cp -r out/wslbridge-backend $pkgdir/usr/bin/
}
